<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cordyline</title>
     <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

 <!-- L√§nk till stylesheet (style.css, Google Fonts). -->  
<link rel="stylesheet" href="style.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Italiana&display=swap" rel="stylesheet">



</head>

<body>
<div class="app-container"> 

<img src="Bilder/ios-ui.png" alt="Ios top UI" class="header">

<h1>Cordyline</h1>

<img style="height: 380px; width: 440px;" src="Bilder/cordyline.png" class="plantInliningCORDYLINE" alt="Cordyline">



  <h2>Fuktighetsniv√•</h2>
  <div class="value" id="humidity">--%</div>

  <div>
    <canvas id="myChart"></canvas>
  </div>


<p id="humidity-status" style="font-weight: bold;">
  60% fuktighet √§r optimalt f√∂r Cordyline
</p>

<!-- ID:et f√∂r v√•r chart och l√§nk till JavaScript-biblioteket f√∂r charten. --> 
<div>
  <canvas id="myChart"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Ta inte bort! Det h√§r scriptet beh√∂vs f√∂r att koppla upp mot MQTT-brokern och visa fuktv√§rdet. --> 
<script>
  // IP-adress till MQTT-servern
  // Notera: porten (9001) √§r till en s√• kallad "websocket"!
  const host = "ws://77.42.37.48:9001";

  // Connect via WebSockets
  const client = mqtt.connect(host);

  client.on("connect", function () {
    console.log("Connected to MQTT WebSocket broker");
    client.subscribe("grupp3/soil/humidity");
  });

  client.on("message", function (topic, message) {
    const humidityValue = Number(message.toString());
    const humidityEl = document.getElementById("humidity");
    const statusEl = document.getElementById("humidity-status");

    humidityEl.innerText = humidityValue + "%";

    if (humidityValue >= 55 && humidityValue <= 65) {
      humidityEl.style.backgroundColor = "#d5e6e7";
      humidityEl.style.color = "#000000";
      statusEl.innerText = humidityValue + "% √§r en bra jordfuktighet f√∂r Cordyline üòä ‚úÖ";
      statusEl.style.color = "#000000";

    } else if (humidityValue < 55) {
      humidityEl.style.backgroundColor = "#FFCA00";
      humidityEl.style.color = "#000000";
      statusEl.innerText = humidityValue + "% fuktighet - jag beh√∂ver vattnas! üò≠‚ö†Ô∏è";
      statusEl.style.color = "#000000";

    } else {
      humidityEl.style.backgroundColor = "#eb5757";
      humidityEl.style.color = "#000000";
      statusEl.innerText = humidityValue + "% fuktighet - jorden √§r f√∂r fuktig! Jag √§r √∂vervattnad üò°üö®";
      statusEl.style.color = "#000000";
    }
  });
</script>
<!-- Slut p√• JavaScript. --> 

<!-- Scripten f√∂r v√•r chart --> 
<div>
  <canvas id="myChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
let chart = null;

async function fetchData() {
  try {
    const response = await fetch('http://localhost:3000/api/moisture');
    const data = await response.json();

    const labels = ['M√•n 15/12', 'Tis 16/12', 'Ons 17/12', 'Tor 18/12',];

    const values = data.map(d => d.value);

    renderChart(labels, values);
  } catch (err) {
    console.error('Fel vid h√§mtning av data:', err);
  }
}

function renderChart(labels, values) {
  const ctx = document.getElementById('myChart');

  if (chart) {
    chart.data.labels = labels;
    chart.data.datasets[0].data = values;
    chart.data.datasets[1].data = Array(values.length).fill(60);
    chart.update();
    return;
  }

  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'V√§xtens fuktighet',
          data: values,
          borderColor: 'rgba(75, 192, 192, 1)',
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          fill: true,
          tension: 0.4
        },
        {
          label: 'Rekommenderad fuktighet',
          data: Array(values.length).fill(60),
          borderColor: 'purple',
          borderDash: [5, 5],
          fill: false,
          pointRadius: 0
        }
      ]
    },
    options: {
      scales: {
        y: {
          min: 0,
          max: 100,
          ticks: {
            callback: value => value + ' %'
          }
        }
      }
    }
  });
}

// Start
fetchData();

// Uppdatera var 12:e timme
//setInterval(fetchData, 50000);
</script>

<!-- Slut p√• JavaScript. --> 

<h3>Tips och sk√∂tselr√•d</h3>

<ul class="list">
  <li>H√•ll jorden fuktig men inte f√∂r v√•t. Runt 60% fuktighet √§r b√§st.</li>
  <li>Cordyline t√•l l√§tt uttorkning, men ska inte torka ut helt. P√• vintern r√§cker det att vattna ungef√§r en g√•ng i veckan.</li>
  <li>Trivs b√§st i halvskugga, inte i direkt solljus.</li>
  
</ul>

<button style="margin-top: 24px;" class="btn" style="background-color: #d5e6e7;">Mer info</button>

<img src="Bilder/nav-bar.png" alt="app nav bar" class="navbar">

</div>
</body>
</html>
